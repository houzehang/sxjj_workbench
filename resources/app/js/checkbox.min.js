/**
* 功能说明:		复选框/单选框的全选反选以及文字点击控制的插件
* @author:		vivy <lizhiziyan@qq.com>
* @time:		2016-08-22 11:15:30
* @version:		V1.1.0
* @js调用方法[复选框]：
* $("#id").selectCheck({
* 	parentSelect:"p",//支持文字也选中的标签，例子中时P标签，根据具体情况换成li,div等。不需要要控制时设为null
* 	allId: 'checkAll',//全选反选input的ID,如果不需要全选反选，则设置为nul
* 	toggleClass: 'check_span--checked',//改变的样式名，针对例子中的复选框样式美化
* 	checkCallBack:function(obj,bool){}//选择之后回调函数,返回obj的是否选中
* })
* @js调用方法[单选框]：
* $("#id").selectRadio({
* 	parentSelect:"p",//支持文字也选中的标签，例子中时P标签，根据具体情况换成li,div等。不需要要控制时设为null
* 	toggleClass: 'radio_span--checked'//改变的样式名，针对例子中的复选框样式美化
* })
*
*/
var _fs = require('fs');
var _utils = require('./js/utils.js');
var root_path = '';
var basecfg_path = '\\src\\gameconfig\\BaseConfig.js';
var logutil_path = '\\src\\fbcore\\utils\\LogUtils_JS.js';
var simulator_path = '\\frameworks\\runtime-src\\Classes\\AppDelegate.cpp';

// function onSave(){
//   var _fs = require('fs');
//   var _root_path = document.getElementById('root_path').value;    
//   if (/\\sxjj$/.test(_root_path) && /:\\/.test(_root_path)) {
//     _fs.exists(_root_path+`\\frameworks\\runtime-src\\proj.win32`, function(exists) {  
//       if (exists) {
//         _fs.writeFile('./root_path.info',_root_path,function(err){
//             if(err){
//               alert("保存失败");
//             }else{
//               root_path = _root_path;
//               alert("保存成功");
//               // window.close();
//             }
//         });
//       }else{
//         alert('请设置正确的项目根目录');
//       }
//     });
//   }else{
//     alert("请设置正确的项目根目录");
//   }
// };

function __checkCheckboxClicked_Tutorial(){
  _fs.readFile(root_path+basecfg_path,'utf8',function(err, data){
    !err && data.split('\n').map(function(line,index){
        /m_isWithoutTutorial:/.test(line) && /true/.test(line) && document.getElementById('checkbox_1').click();
    });
  });
};

function __checkCheckboxClicked_Log(){
  _fs.readFile(root_path+logutil_path,'utf8',function(err, data){
    !err && data.split('\n').map(function(line,index){
        /log_flag:/.test(line) && /false/.test(line) && document.getElementById('checkbox_2').click();
    });
  });
};

function __checkCheckboxClicked_NomalSize(){
  _fs.readFile(root_path+simulator_path,'utf8',function(err, data){
    !err && data.split('\n').map(function(line,index){
        /1334/.test(line) && /750/.test(line) && document.getElementById('checkbox_3').click();
    });
  });
};

_fs.readFile('./root_path.info', 'utf8', function(err, data){
  if (err) {
    root_path = '';
  }else{
    // document.getElementById('root_path').value = data;
    root_path = data;
    __checkCheckboxClicked_Tutorial();
    __checkCheckboxClicked_Log();
    __checkCheckboxClicked_NomalSize();
  }
});


(function($) {
    $.fn.extend({
        selectCheck: function(f) {
            var g = {
                parentSelect: "p",
                allId: 'checkAll',
                toggleClass: 'check_span--checked',
                checkCallBack: function(a, b) {}
            };
            var f = $.extend(g, f);

            function checkAll(a, b, c, d) {
                if (!root_path || root_path.length == 0) {
                    alert('请设置正确的项目根目录');
                    // setTimeout(function(){
                    //     window.open('./extends/electron_form.html');
                    // },200);
                    checkbox.checked=false;
                    return;
                }

                var o = f;
                var e = $("#" + o.allId);
                if (o.checkCallBack && $.isFunction(o.checkCallBack)) {
                    o.checkCallBack.call(this, d, c)
                }

                if (b.attr("id") == o.allId) {
                    if (c) {

                        a.prop("checked", true);
                        a.parent().addClass(o.toggleClass);
                        b.prop("checked", true)
                    } else {

                        a.removeAttr("checked");
                        a.parent().removeClass(o.toggleClass);
                        b.removeAttr("checked")
                    }
                } else {
                    if (!c) {


                        //取消选中

                        if (/1$/.test(b.attr("id"))) {
                          _utils.replaceOneLine(root_path+basecfg_path,'m_isWithoutTutorial:','    m_isWithoutTutorial:false,//====== 新手引导是否隐藏 ======',function(err){
                            err && alert(err);
                          });
                        }else if (/2$/.test(b.attr("id"))){
                          _utils.replaceOneLine(root_path+logutil_path,'log_flag:','    log_flag:true,      ////普通log开关',function(err){
                            err && alert(err);
                          });
                        }else if (/3$/.test(b.attr("id"))) {
                          _utils.replaceOneLine(root_path+simulator_path,'createWithRect','        glview = cocos2d::GLViewImpl::createWithRect("FireBirdJS", Rect(0,0,2048,1920), 0.5);',function(err){
                            err && alert(err);
                          });
                        }

                        b.removeAttr("checked");
                        b.parent().removeClass(o.toggleClass);
                        e.parent().removeClass(o.toggleClass);
                        e.removeAttr("checked")
                    } else {


                        //被选中
                        if (/1$/.test(b.attr("id"))) {
                          _utils.replaceOneLine(root_path+basecfg_path,'m_isWithoutTutorial:','    m_isWithoutTutorial:true,//====== 新手引导是否隐藏 ======',function(err){
                            err && alert(err);
                          });
                        }else if (/2$/.test(b.attr("id"))){
                          _utils.replaceOneLine(root_path+logutil_path,'log_flag:','    log_flag:false,      ////普通log开关',function(err){
                            err && alert(err);
                          });
                        }else if (/3$/.test(b.attr("id"))) {
                          _utils.replaceOneLine(root_path+simulator_path,'createWithRect','        glview = cocos2d::GLViewImpl::createWithRect("FireBirdJS", Rect(0,0,750,1334), 0.5);',function(err){
                            err && alert(err);
                          });
                        }

                        b.prop("checked", true);
                        b.parent().addClass(o.toggleClass);
                        for (var i = 0; i < a.length; i++) {
                            if (a[i].checked == false && a[i].id != o.allId) return
                        }
                        e.parent().addClass(o.toggleClass);
                        e.prop("checked", true)
                    }
                }
            }
            return this.each(function() {
                var o = f;
                var b = $(this);
                var c = this;
                var d = $('input:checkbox', b);
                if (o.parentSelect) {
                    d.parents(o.parentSelect).click(function(e) {
                        if (o.allId) {
                            var a = $(this).find("input:checkbox");
                            if ($(e.target).attr("type") == "checkbox") checkAll(d, $(e.target), e.target.checked, b);
                            else checkAll(d, a, !a.is(":checked"), b)
                        } else {
                            if ($(e.target).attr("type") == "checkbox") {
                                $(e.target).parent().toggleClass(o.toggleClass);
                                if (o.checkCallBack && $.isFunction(o.checkCallBack)) {
                                    o.checkCallBack.call(c, b, e.target.checked)
                                }
                            } else {
                                $('input:checkbox', $(this)).parent().toggleClass(o.toggleClass);
                                if (o.checkCallBack && $.isFunction(o.checkCallBack)) {
                                    o.checkCallBack.call(c, b, $('input:checkbox', $(this)).is(":checked"))
                                }
                            }
                        }
                    });
                    return
                }
                d.click(function() {
                    if (o.allId) {
                        checkAll(d, $(this), this.checked.obj)
                    } else {
                        $(this).parent().toggleClass(o.toggleClass);
                        if (o.checkCallBack && $.isFunction(o.checkCallBack)) {
                            o.checkCallBack.call(c, b, this.checked)
                        }
                    }
                })
            })
        },
        selectRadio: function(c) {
            var d = {
                parentSelect: "p",
                toggleClass: 'radio_span--checked'
            };
            var c = $.extend(d, c);
            return this.each(function() {
                var o = c;
                var a = $(this);
                var b = $('input:radio', a);
                if (o.parentSelect) {
                    b.parents(o.parentSelect).click(function(e) {
                        b.parent().removeClass(o.toggleClass);
                        if ($(e.target).attr("type") == "radio") $(e.target).parent().addClass(o.toggleClass);
                        else $("input:radio", $(this)).parent().addClass(o.toggleClass)
                    });
                    return
                }
                b.click(function() {
                    b.parent().removeClass(o.toggleClass);
                    $(this).parent().addClass(o.toggleClass)
                })
            })
        }
    })
})(jQuery);







